// Test 19: Word Frequency Count
// Count word frequencies, sort by frequency then alphabetically

fn to_lower(s: str) -> str {
    // Simple lowercase conversion
    let result = "";
    let len = str::len(s);
    let i = 0;
    while i < len {
        let c = str::char_at(s, i);
        // Convert A-Z to a-z
        if c >= "A" && c <= "Z" {
            result = result + str::char_lower(c);
        } else {
            result = result + c;
        }
        i = i + 1;
    }
    return result;
}

fn main() {
    let text = "the quick brown fox jumps over the lazy dog the fox is quick";

    // Split into words
    let words = str::split(text, " ");
    let word_count = str::split_len(text, " ");

    // Track unique words and counts (parallel arrays)
    let unique_words: str[] = [];
    let counts: int[] = [];
    let unique_count = 0;

    let i = 0;
    while i < word_count {
        let word = to_lower(words[i]);

        // Find if word exists
        let found = -1;
        let j = 0;
        while j < unique_count {
            if unique_words[j] == word {
                found = j;
                break;
            }
            j = j + 1;
        }

        if found >= 0 {
            counts[found] = counts[found] + 1;
        } else {
            unique_words = unique_words + [word];
            counts = counts + [1];
            unique_count = unique_count + 1;
        }
        i = i + 1;
    }

    // Sort by frequency (descending), then alphabetically
    // Simple bubble sort
    i = 0;
    while i < unique_count - 1 {
        let j = 0;
        while j < unique_count - 1 - i {
            let swap = false;
            if counts[j] < counts[j + 1] {
                swap = true;
            } else if counts[j] == counts[j + 1] && unique_words[j] > unique_words[j + 1] {
                swap = true;
            }

            if swap {
                let tmp_word = unique_words[j];
                let tmp_count = counts[j];
                unique_words[j] = unique_words[j + 1];
                counts[j] = counts[j + 1];
                unique_words[j + 1] = tmp_word;
                counts[j + 1] = tmp_count;
            }
            j = j + 1;
        }
        i = i + 1;
    }

    // Print results
    i = 0;
    while i < unique_count {
        print(unique_words[i] + ": " + str::from_int(counts[i]));
        i = i + 1;
    }
}
